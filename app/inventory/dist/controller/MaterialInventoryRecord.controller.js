sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/model/odata/v4/ODataModel","sap/m/MessageToast"],function(e,t,o,a,i,n){"use strict";return e.extend("inventory.controller.MaterialInventoryRecord",{onInit:function(){let e={data:[{SNo:1,Category:"",Quantity:null,MaterialCode:"",Description:"",SubcomponentList:[]}]};let t=new o({});t.setData(e);this.getView().setModel(t,"tempModel");let a=this.getView().getModel("tempModel");console.log(a)},onDeleteRow:function(e){var t=this.byId("entryTypeTable");var o=t.getModel("tempModel");var a=o.getProperty("/data");var i=e.getSource().getParent();var n=i.getBindingContext("tempModel");var l=n.getPath().split("/data/")[1];a.splice(l,1);a.forEach(function(e,t){e.SNo=(t+1).toString()});o.setProperty("/data",a)},onDeleteSubComponnentRow:function(e){var t=e.getSource().getParent();var o=t.getModel("subcomponentModel");var a=o.getProperty("/subData");var i=e.getSource().getParent();var n=i.getBindingContext("subcomponentModel");var l=n.getPath().split("/subData/")[1];a.splice(l,1);a.forEach(function(e,t){e.SNo=(t+1).toString()});o.setProperty("/subData",a)},onOpenSubComponent:function(e){this.oSourceRow=e.getSource().getBindingContext("tempModel");let t=this.oSourceRow.getObject().SubcomponentList;let a=new o;let i={subData:[{SNo:1,Description:"",Category:"",MaterialCode:"",Parent_MaterialCode:"",Quantity:""}]};if(!t){a.setData(i)}else{a.setData({subData:t})}this.getView().setModel(a,"subcomponentModel");if(!this._subcomponentDialog){this._subcomponentDialog=sap.ui.xmlfragment("inventory.fragments.AddSubComponent",this);this.getView().addDependent(this._subcomponentDialog)}this._subcomponentDialog.open()},subcomponentDialogClose:function(){this._subcomponentDialog.close()},onAddMaterial:function(){let e=this.getView().getModel("tempModel");let t=e.getData().data;let o=t.length+1;let a={SNo:o.toString(),Category:"",Quantity:"",MaterialCode:"",Description:"",SubcomponentList:[]};t.push(a);e.setData({data:t})},onAddSubMaterial:function(){let e=this.getView().getModel("subcomponentModel");let t=e.getProperty("/subData")||[];let o=t.length>0?t.length+1:1;let a={SNo:o,Description:"",MaterialCode:"",Category:"",Quantity:"",Parent_MaterialCode:""};t.push(a);e.setProperty("/subData",t)},showMaterialValueHelp:function(e){this._oInputField=e.getSource().getBindingContext("tempModel");if(!this._MaterialDialog){this._MaterialDialog=sap.ui.xmlfragment("inventory.fragments.MaterialValueHelp",this);this.getView().addDependent(this._MaterialDialog)}this._MaterialDialog.open();if(this._MaterialDialog){this._MaterialDialog.getBinding("items").filter([])}},showMaterialValueHelp2:function(e){this._oInputField=e.getSource().getBindingContext("subcomponentModel");if(!this._MaterialDialog2){this._MaterialDialog2=sap.ui.xmlfragment("inventory.fragments.SubcomponentValueHelp",this);this.getView().addDependent(this._MaterialDialog2)}this._MaterialDialog2.open();if(this._MaterialDialog2){this._MaterialDialog2.getBinding("items").filter([])}},onGenerateCodePress:async function(e){let o=this.getView();let a=o.getModel("tempModel").getData().data;let i=o.getModel();let n=i.bindList("/Material");let l=[];if(!a.length){t.warning("Please Add Some Material");return}const r=e=>new Promise((t,o)=>{if(e.SubcomponentList.length){e.SubcomponentList.forEach(e=>e.Quantity=parseInt(e.Quantity))}let a={Description:e.Description,Category:e.Category,MaterialCode:e.MaterialCode,Status:"Active",Quantity:parseInt(e.Quantity),SubcomponentList:e.SubcomponentList};n.create(a,true);n.attachCreateCompleted(a=>{let i=a.getParameters();let n=i.context;if(i.success){let o=n.getObject();e.MaterialCode=o.MaterialCode;t(o.MaterialCode)}else{o(i)}})});for(let e=0;e<a.length;e++){let o=a[e];if(!o.Description&&!o.Category&&!o.Quantity){t.warning("Please add Materials details to proceed");return}if(!o.MaterialCode&&!o.SubcomponentList.length){t.warning("Please Add Subcomponents or Select material from Value help");return}if(!o.MaterialCode&&o.SubcomponentList&&o.SubcomponentList.length>0){o.SubcomponentList.forEach(e=>{delete e.SNo});try{let t=await r(o);l.push(`${e+1}: ${t}`);o.SubcomponentList.forEach(e=>e.Parent_MaterialCode=t.trim())}catch(e){console.log("Error creating material:",e);t.error("Error generating MaterialCode. Please try again.")}}}this.getView().getModel("tempModel").refresh();if(l.length>0){l.forEach(e=>{let[t,o]=e.split(":");a[t-1].MaterialCode=o.trim()});o.getModel("tempModel").refresh();console.table(l);if(l.length>1){t.success(`Generated Codes are - \n ${l.join("\n")}`)}else{t.success(`Generated Code - \n ${l.join("\n")}`)}}else{t.warning("No Material found for Code Generation")}},onSubmitPress:function(e){let o=this.getView();let a=o.getModel("tempModel").getData().data;let i=[];let n=true;a.forEach(e=>{if(!e.Category||!e.Description||!e.Quantity){i.push(e);n=false}});if(i.length>0){t.warning("Please fill up Material Details for all materials");return}let l=a.filter(e=>!e.MaterialCode);if(l.length>0){t.warning("Please generate Material Codes for all materials with subcomponents");return}let r=o.getModel().bindList("/serviceRequest");let s=[];a.forEach(e=>{e.Quantity=parseInt(e.Quantity);let t={...e};delete t.SNo;t.f_MaterialCode=t.MaterialCode;if(t.SubcomponentList){t.SubcomponentList.forEach(e=>{e.Quantity=parseInt(e.Quantity);e.reqNo=0;delete e.SNo})}s.push({...t,SubcomponentList:t.SubcomponentList})});r.create({Materials:s,reqStatus:"Material Record Created"},true);r.attachCreateCompleted(e=>{let t=e.getParameters();let i=t.context;if(t.success){let e=i.getObject();console.log(e);sap.m.MessageBox.success(`Material Request No. ${e.reqNo} has been created Successfully.`,{title:"Success",actions:[sap.m.MessageBox.Action.OK],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){let e=o.getModel("tempModel");e.setData({data:[{SNo:1,Category:"",Quantity:null,MaterialCode:"",Description:"",SubcomponentList:[]}]});e.refresh()}}});a=[];o.getModel().refresh()}else{console.log(t)}})},showCatergoryValueHelp:function(e){this.oSource=e.getSource().getBindingContext("tempModel");if(!this._CategoryDialog){this._CategoryDialog=sap.ui.xmlfragment("inventory.fragments.CategoryValueHelp",this);this.getView().addDependent(this._CategoryDialog)}this._CategoryDialog.open();if(this._CategoryDialog){this._CategoryDialog.getBinding("items").filter([])}},onSaveRowSubComponentBtn:function(e){let t=this.oSourceRow;let o=this.getView().getModel("subcomponentModel").getData();t.getObject().SubcomponentList=o.subData;console.log("kjhd  ",this.getView().getModel("tempModel").getData());console.log("sub data ",o.subData);this._subcomponentDialog.close()},onClearRow:function(e){var t=e.getSource().getBindingContext("tempModel");if(t){var o=t.getPath();var a=t.getModel();a.setProperty(o+"/Description","");a.setProperty(o+"/Category","");a.setProperty(o+"/Quantity","");a.setProperty(o+"/MaterialCode","")}},onMaterialValueHelpClose:async function(e){let t=e.getParameter("selectedItem");let o=t.getBindingContext().getObject();let a=this._oInputField;let i=a.getPath();let n=this.getView().getModel("tempModel");n.setProperty(i+"/Description",o.Description);n.setProperty(i+"/MaterialCode",o.MaterialCode);n.setProperty(i+"/Category",o.Category);if(!t){if(that._MaterialDialog){that._MaterialDialog.destroy();that._MaterialDialog=null}return}},onSubcomponentValueHelpClose:async function(e){let t=e.getParameter("selectedItem");let o=t.getBindingContext().getObject();let a=this._oInputField;let i=a.getPath();let n=this.getView().getModel("subcomponentModel");n.setProperty(i+"/Description",o.Description);n.setProperty(i+"/MaterialCode",o.MaterialCode);n.setProperty(i+"/Category",o.Category);if(!t){if(that._MaterialDialog){that._MaterialDialog.destroy();that._MaterialDialog=null}return}},onCategoryValueHelpClose:function(e){let t=e.getParameter("selectedItem");let o=t.getBindingContext().getObject();let a=this.oSource;let i=a.getPath();let n=this.getView().getModel("tempModel");n.setProperty(i+"/Category",o.Type);if(!t){if(that._MaterialDialog){that._MaterialDialog.destroy();that._MaterialDialog=null}return}},onMaterialFilterSearch:function(e){let t=e.getParameter("value");let o=e.getSource();let a=o.getBinding("items");let i=[];if(t){let e=new sap.ui.model.Filter("MaterialCode",sap.ui.model.FilterOperator.Contains,t);let o=new sap.ui.model.Filter("Description",sap.ui.model.FilterOperator.Contains,t);let a=new sap.ui.model.Filter({filters:[e,o],and:false});i.push(a)}a.filter(i);setTimeout(()=>{let e=a.getCurrentContexts();if(e&&e.length===0){o.setNoDataText("No data")}else{o.setNoDataText("Loading...")}},200)}})});
//# sourceMappingURL=MaterialInventoryRecord.controller.js.map