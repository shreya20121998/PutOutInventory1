sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/model/odata/v4/ODataModel","sap/m/MessageToast","sap/ui/export/Spreadsheet"],function(e,t,a,i,r,o,l){"use strict";return e.extend("inventory.controller.InventoryDashboard",{onInit:function(){},removeCommas:function(e){if(e){return e.toString().replace(/,/g,"")}return e},onGoFilter:function(){var e=this.byId("inventoryDataTable");var t=e.getBinding("items");var a=[];var i=this.byId("materialReqNoFilter").getValue();var r=this.byId("categoryFilter").getSelectedKey();var o=this.byId("statusFilter").getSelectedKey();var l=this.byId("dateFilter").getDateValue();if(i){a.push(new sap.ui.model.Filter("reqNo",sap.ui.model.FilterOperator.EQ,i))}if(r){a.push(new sap.ui.model.Filter("Category",sap.ui.model.FilterOperator.EQ,r))}if(o){a.push(new sap.ui.model.Filter("MatStatus",sap.ui.model.FilterOperator.EQ,o))}if(l){var n=new Date(l.setHours(0,0,0,0));var s=new Date(l.setHours(23,59,59,999));a.push(new sap.ui.model.Filter({path:"createdAt",operator:sap.ui.model.FilterOperator.BT,value1:n.toISOString(),value2:s.toISOString()}))}t.filter(a)},onQuantity:function(e){var t=e.getSource().getBindingContext();var a=t.getObject();var i=a.MaterialCode;var r=a.reqNo;console.log("Material Code",i,r);let l=this.getView().getModel();let n=l.bindList("/splitMaterilalTable");var s=[new sap.ui.model.Filter("MaterialCode",sap.ui.model.FilterOperator.EQ,i),new sap.ui.model.Filter("reqNo",sap.ui.model.FilterOperator.EQ,r)];n.filter(s).requestContexts().then(function(e){if(e.length>0){let t=e.map(e=>e.getObject());let a=new sap.ui.model.json.JSONModel({splitMaterilalTable:t});this._oQuantityDialog.setModel(a);this._oQuantityDialog.open()}else{o.show("There is no split Materials available.")}}.bind(this)).catch(function(e){console.error("Error while requesting contexts:",e)});if(!this._oQuantityDialog){this._oQuantityDialog=sap.ui.xmlfragment("inventory.fragments.QuantityDialog",this);this.getView().addDependent(this._oQuantityDialog)}},handleQuantityDialogClose:function(){if(this._oQuantityDialog){this._oQuantityDialog.close()}},onRefresh:function(){var e=this.byId("inventoryDataTable");e.setBusy(true);this.byId("materialReqNoFilter").setValue("");this.byId("dateFilter").setDateValue(null);this.byId("categoryFilter").setSelectedKey("");this.byId("statusFilter").setSelectedKey("");var t=e.getBinding("items");t.filter([]);setTimeout(function(){e.setBusy(false)},1e3)},onViewPress:function(e){var t=e.getSource().getBindingContext();var a=t.getObject();var i=a.MaterialCode;var r=a.reqNo;console.log("Material code =",i);console.log("Material req no =",r);let o=this.getView().getModel();let l=o.bindList("/rqSubMaterial");var n=[new sap.ui.model.Filter("Parent_MaterialCode",sap.ui.model.FilterOperator.EQ,i),new sap.ui.model.Filter("reqNo",sap.ui.model.FilterOperator.EQ,r)];l.filter(n).requestContexts().then(function(e){if(e.length>0){let t=e.map(e=>e.getObject());let a=new sap.ui.model.json.JSONModel({rqSubMaterial:t});this._oDialog.setModel(a);this._oDialog.open()}else{sap.m.MessageBox.information("No Sub Component found for this :"+i)}}.bind(this)).catch(function(e){console.error("Error while requesting contexts:",e)});if(!this._oDialog){this._oDialog=sap.ui.xmlfragment("inventory.fragments.SubComponent",this);this.getView().addDependent(this._oDialog)}},handleValueHelpClose:function(){this._oDialog.close()},onDownloadPress:function(e){var t=e.getSource().getBindingContext();var a=t.getObject();var i=a.MaterialCode;var r=[];var o=[{label:"Material Req No",property:"MaterialReqNo"},{label:"Material Code",property:"MaterialCode"},{label:"Material Description",property:"MaterialDescription"},{label:"Category",property:"Category"},{label:"Status",property:"Status"},{label:"Created By",property:"CreatedBy"},{label:"Created On",property:"CreatedOn"},{label:"Sub Material Code",property:"SubMaterialCode"},{label:"Sub Description",property:"SubDescription"},{label:"Sub Category",property:"SubCategory"},{label:"Quantity",property:"Quantity"}];var l=this.getView().getModel().bindList("/rqSubMaterial",null,null,new sap.ui.model.Filter("Parent_MaterialCode",sap.ui.model.FilterOperator.EQ,i));l.requestContexts().then(function(e){e.forEach(function(e){var t=e.getObject();r.push({MaterialReqNo:a.reqNo,MaterialCode:a.MaterialCode,MaterialDescription:a.Description,Category:a.Category,Status:a.Status,CreatedBy:a.createdBy,CreatedOn:a.createdAt,SubMaterialCode:t.MaterialCode,SubDescription:t.Description,SubCategory:t.Category,Quantity:t.Quantity})});var t=new sap.ui.export.Spreadsheet({workbook:{columns:o},dataSource:r,fileName:"Material_Data.xlsx"});t.build().finally(function(){t.destroy()})}).catch(function(e){sap.m.MessageToast.show("Error fetching subcomponents.")})}})});
//# sourceMappingURL=InventoryDashboard.controller.js.map